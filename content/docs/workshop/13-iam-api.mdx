---
title: "API Lambda IAM Role"
description: "Create a role for the API Lambda."
---

import { Tabs, Tab } from "fumadocs-ui/components/tabs";
import { Callout } from "fumadocs-ui/components/callout";
import { Steps, Step } from "fumadocs-ui/components/steps";

## Goal

Create an IAM role for the **API Lambda** that can:

- read people metadata from DynamoDB (`Persons`)
- query person → photo mappings from DynamoDB (`Occurrences`)
- fetch photo metadata from DynamoDB (`Photos`)
- write logs to CloudWatch

<Callout type="warning" title="Least privilege">
  Do not use broad policies like <code>AdministratorAccess</code>. We'll grant
  only the exact permissions this Lambda needs.
</Callout>

<Steps>
  <Step>
    ## Create the IAM role

    1. Go to **IAM → Roles → Create role**
    2. **Trusted entity:** AWS service
    3. **Use case:** **Lambda**
    4. Click on **Next**
    5. Skip to Step 3 by clicking on **Name, review and create** on the step indicator
    6. **Role name**: `beetroot-api-role`
    7. Click **Create role**

</Step>

<Step>
    ## Add logging permissions

    1. Open the role: **IAM → Roles → `beetroot-ingest-role`**
    2. Go to **Permissions → Add permissions → Attach policies**
    3. Select: <code>AWSLambdaBasicExecutionRole</code>
    4. Click **Add Permissions**

  </Step>

  <Step>
  ## Create the permissions policy

We'll build a least-privilege policy using the **visual editor**, and then you can verify it with JSON.

1. Open the role: **IAM → Roles → beetroot-ingest-role**
2. Click **Add permissions → Create inline policy**
3. Choose the **Visual** editor (not JSON)

<Tabs items={["DynamoDB permissions"]} groupId="iam-editor-api" persist>

  <Tab value="DynamoDB permissions">
    1. Select service: <b>DynamoDB</b>

    2. Under <b>Actions</b>:
       - Expand <b>Read</b> and select:
         - <code>GetItem</code>
         - <code>Query</code>
         - <code>Scan</code>

    3. Under <b>Resources</b>:
       - Choose <b>Specific</b>
       - In <b>Table</b>, click <b>Add ARN</b>

    4. In the <b>Add ARN</b> popup, add these 3 table ARNs (same region: <code>us-east-1</code>):
        **Persons table**

        - Table name: `Persons`
        - Table ARN: `arn:aws:dynamodb:us-east-1:<ACCOUNT_ID>:table/Persons`

        **Occurrences table**

        - Table name: `Occurrences`
        - Table ARN: `arn:aws:dynamodb:us-east-1:<ACCOUNT_ID>:table/Occurrences`

        **Photos table**

        - Table name: `Photos`
        - Table ARN: `arn:aws:dynamodb:us-east-1:<ACCOUNT_ID>:table/Photos`

        <Callout type="warn" title="Where do I get &lt;ACCOUNT_ID&gt;?">
          Run <code>aws sts get-caller-identity</code> and copy the <code>Account</code>{" "}
          value or copy it from top-right corner of console.
        </Callout>

  </Tab>

  </Tabs>

  </Step>

  <Step>
  ## Save the inline policy

    1. Click **Next**
    2. **Policy name:** <code>BeetrootAPIPolicy</code>
    3. Click **Create policy**
      </Step>

</Steps>

## Full Policy JSON

You can verify your policy configuration by switching to the **JSON** editor and comparing it against the policy document below. Alternatively, paste the following JSON directly to attach all required permissions at once.

> Replace bucket names if yours differ.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DynamoReadForApi",
      "Effect": "Allow",
      "Action": ["dynamodb:GetItem", "dynamodb:Query", "dynamodb:Scan"],
      "Resource": [
        "arn:aws:dynamodb:us-east-1:<ACCOUNT_ID>:table/Persons",
        "arn:aws:dynamodb:us-east-1:<ACCOUNT_ID>:table/Occurrences",
        "arn:aws:dynamodb:us-east-1:<ACCOUNT_ID>:table/Photos"
      ]
    }
  ]
}
```

## Checkpoint

In the role's **Permissions** tab, you should see:

- <code>AWSLambdaBasicExecutionRole</code>
- <code>BeetrootAPIPolicy</code>
